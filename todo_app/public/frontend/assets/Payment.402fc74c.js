var x=(E,C,u)=>new Promise((_,b)=>{var h=i=>{try{f(u.next(i))}catch(a){b(a)}},w=i=>{try{f(u.throw(i))}catch(a){b(a)}},f=i=>i.done?_(i.value):Promise.resolve(i.value).then(h,w);f((u=u.apply(E,C)).next())});import{k as P,l as p,a as N,G as Q,H as k,b as n,d as e,t as l,e as y,u as m,p as F,q as R,F as j,r as L,v as V,I as B,i as S,J as K,j as H,s as v,o as r}from"./index.69713cc7.js";import{C as W}from"./circle-check-big.3b7df12b.js";import{C as Y}from"./clock.5422cd0b.js";/**
 * @license lucide-vue-next v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=P("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-vue-next v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=P("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=P("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=P("indian-rupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);/**
 * @license lucide-vue-next v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=P("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-vue-next v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=P("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),le={class:"min-h-screen bg-gray-50 p-6"},ne={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},re={class:"bg-white rounded-lg shadow p-6 border-l-4 border-green-500"},de={class:"flex items-center justify-between"},ie={class:"text-2xl font-bold text-gray-900"},ue={class:"bg-white rounded-lg shadow p-6 border-l-4 border-yellow-500"},ce={class:"flex items-center justify-between"},pe={class:"text-2xl font-bold text-gray-900"},ye={class:"bg-white rounded-lg shadow p-6 border-l-4 border-red-500"},me={class:"flex items-center justify-between"},ge={class:"text-2xl font-bold text-gray-900"},xe={class:"bg-white rounded-lg shadow p-6 border-l-4 border-blue-500"},fe={class:"flex items-center justify-between"},ve={class:"text-2xl font-bold text-gray-900"},_e={class:"bg-white rounded-lg shadow mb-6"},be={class:"p-6"},he={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},we=["disabled"],ke={value:""},Pe=["value"],ze={class:"flex items-end"},Ce=["disabled"],Ie={class:"bg-white rounded-lg shadow mb-6 p-4"},Me={class:"flex gap-4 items-center"},Fe={class:"flex-1"},Se={class:"bg-white rounded-lg shadow"},Te={key:0,class:"p-8 text-center"},Ee={key:1,class:"p-8 text-center"},Ae={key:2,class:"overflow-x-auto"},De={class:"w-full"},Ne={class:"divide-y divide-gray-200"},Re={class:"px-6 py-4 whitespace-nowrap"},je={class:"font-mono text-sm text-gray-900"},Le={class:"px-6 py-4"},Ve={class:"text-sm text-gray-900"},Be={class:"px-6 py-4 whitespace-nowrap"},He={class:"text-sm font-semibold text-gray-900"},$e={class:"px-6 py-4 whitespace-nowrap"},qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},Ue={class:"px-6 py-4 whitespace-nowrap"},Oe={class:"flex gap-2"},Xe=["onClick"],Ge=["onClick"],Je={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Qe={class:"p-6 border-b flex justify-between items-center"},Ke={key:0,class:"p-6 space-y-4"},We={class:"grid grid-cols-2 gap-4"},Ye={class:"font-semibold"},Ze={class:"font-semibold"},et={class:"font-semibold text-lg"},tt={key:0},st={class:"font-mono text-xs"},ot={key:1},at={class:"font-mono text-xs"},lt={key:2},nt={class:"font-semibold"},rt={class:"font-semibold"},dt={key:3,class:"col-span-2"},it={class:"font-semibold"},ut={key:4,class:"col-span-2"},ct={class:"text-red-600 text-sm"},xt={__name:"Payment",setup(E){const C=p([]),u=p([]),_=p(!1),b=p(!1),h=p(!1),w=p(""),f=p("all"),i=p(!1),a=p(null),c=p({todoItem:"",amount:null}),I=N(()=>({success:u.value.filter(s=>s.payment_status==="Success").length,pending:u.value.filter(s=>s.payment_status==="Pending").length,failed:u.value.filter(s=>s.payment_status==="Failed").length,totalAmount:u.value.filter(s=>s.payment_status==="Success").reduce((s,t)=>s+(t.amount||0),0).toFixed(2)})),A=N(()=>{let s=u.value;if(f.value!=="all"&&(s=s.filter(t=>t.payment_status===f.value)),w.value){const t=w.value.toLowerCase();s=s.filter(o=>o.name.toLowerCase().includes(t)||o.todo_item.toLowerCase().includes(t))}return s});Q(()=>{$(),z(),U()});function $(){return x(this,null,function*(){_.value=!0;try{const s=yield k("frappe.client.get_list",{doctype:"Todo Item",fields:["name","task_title","status"],limit_page_length:100});C.value=s||[]}catch(s){console.error("Error loading todos:",s),d("Failed to load todo items","error")}finally{_.value=!1}})}function z(){return x(this,null,function*(){b.value=!0;try{const s=yield k("frappe.client.get_list",{doctype:"Todo Payment",fields:["name","todo_item","amount","payment_status","razorpay_order_id","razorpay_payment_id","payment_date","payment_method","error_message","creation"],order_by:"creation desc",limit_page_length:100});u.value=s||[]}catch(s){console.error("Error loading payments:",s),d("Failed to load payments","error")}finally{b.value=!1}})}function q(){return x(this,null,function*(){if(!c.value.todoItem||!c.value.amount){d("Please fill all fields","error");return}h.value=!0;try{const s=yield k("todo_app.todo_app.doctype.todo_payment.todo_payment.create_payment",{todo_item:c.value.todoItem,amount:c.value.amount});s&&s.success?(d("Payment created successfully","success"),c.value={todoItem:"",amount:null},yield z(),setTimeout(()=>{D(s)},500)):d(s.message||"Failed to create payment","error")}catch(s){console.error("Error creating payment:",s),d("Failed to create payment","error")}finally{h.value=!1}})}function U(){if(document.getElementById("razorpay-script"))return;const s=document.createElement("script");s.id="razorpay-script",s.src="https://checkout.razorpay.com/v1/checkout.js",document.head.appendChild(s)}function D(s){if(typeof Razorpay=="undefined"){d("Razorpay not loaded. Please refresh the page.","error");return}const t={key:s.key_id,amount:s.amount*100,currency:"INR",name:"Todo App",description:"Payment for Todo Item",order_id:s.razorpay_order_id,handler:function(g){return x(this,null,function*(){yield O(s.payment_id,g.razorpay_payment_id,g.razorpay_order_id,g.razorpay_signature)})},theme:{color:"#3B82F6"},modal:{ondismiss:function(){d("Payment cancelled","info")}}},o=new Razorpay(t);o.on("payment.failed",function(g){return x(this,null,function*(){yield X(s.payment_id,g.error.description)})}),o.open()}function O(s,t,o,g){return x(this,null,function*(){try{const M=yield k("todo_app.todo_app.doctype.todo_payment.todo_payment.verify_payment",{payment_id:s,razorpay_payment_id:t,razorpay_order_id:o,razorpay_signature:g});M&&M.success?(d("Payment successful!","success"),yield z()):d("Payment verification failed","error")}catch(M){console.error("Error verifying payment:",M),d("Payment verification failed","error")}})}function X(s,t){return x(this,null,function*(){try{yield k("todo_app.todo_app.doctype.todo_payment.todo_payment.handle_payment_failure",{payment_id:s,error_description:t}),d("Payment failed: "+t,"error"),yield z()}catch(o){console.error("Error handling payment failure:",o)}})}function G(s){return x(this,null,function*(){try{const t=yield k("frappe.client.get",{doctype:"Todo Payment",name:s.name}),o={key_id:t.key_id,amount:t.amount,razorpay_order_id:t.razorpay_order_id,payment_id:t.name};D(o)}catch(t){console.error("Error retrying payment:",t),d("Failed to retry payment","error")}})}function J(s){a.value=s,i.value=!0}function T(s){return s?new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}function d(s,t="info"){console.log(`[${t}] ${s}`),alert(s)}return(s,t)=>(r(),n("div",le,[t[32]||(t[32]=e("div",{class:"mb-6"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Payments"),e("p",{class:"text-gray-500 mt-1"},"Manage your todo item payments")],-1)),e("div",ne,[e("div",re,[e("div",de,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-sm text-gray-600"},"Successful",-1)),e("p",ie,l(I.value.success),1)]),y(m(W),{class:"w-10 h-10 text-green-500"})])]),e("div",ue,[e("div",ce,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm text-gray-600"},"Pending",-1)),e("p",pe,l(I.value.pending),1)]),y(m(Y),{class:"w-10 h-10 text-yellow-500"})])]),e("div",ye,[e("div",me,[e("div",null,[t[8]||(t[8]=e("p",{class:"text-sm text-gray-600"},"Failed",-1)),e("p",ge,l(I.value.failed),1)]),y(m(Z),{class:"w-10 h-10 text-red-500"})])]),e("div",xe,[e("div",fe,[e("div",null,[t[9]||(t[9]=e("p",{class:"text-sm text-gray-600"},"Total Amount",-1)),e("p",ve,"\u20B9"+l(I.value.totalAmount),1)]),y(m(se),{class:"w-10 h-10 text-blue-500"})])])]),e("div",_e,[t[12]||(t[12]=e("div",{class:"p-6 border-b"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Create New Payment")],-1)),e("div",be,[e("div",he,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Select Todo Item ",-1)),F(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>c.value.todoItem=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:_.value},[e("option",ke,l(_.value?"Loading...":"Select a todo item"),1),(r(!0),n(j,null,L(C.value,o=>(r(),n("option",{key:o.name,value:o.name},l(o.name)+" - "+l(o.task_title),9,Pe))),128))],8,we),[[R,c.value.todoItem]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Amount (\u20B9) ",-1)),F(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>c.value.amount=o),type:"number",min:"1",step:"0.01",placeholder:"Enter amount",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[V,c.value.amount,void 0,{number:!0}]])]),e("div",ze,[e("button",{onClick:q,disabled:!c.value.todoItem||!c.value.amount||h.value,class:"w-full bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors"},[y(m(B),{class:"w-5 h-5"}),S(" "+l(h.value?"Processing...":"Create & Pay"),1)],8,Ce)])])])]),e("div",Ie,[e("div",Me,[e("div",Fe,[F(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>w.value=o),type:"text",placeholder:"Search by payment ID or todo item...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},null,512),[[V,w.value]])]),F(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>f.value=o),class:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[...t[13]||(t[13]=[e("option",{value:"all"},"All Status",-1),e("option",{value:"Success"},"Success",-1),e("option",{value:"Pending"},"Pending",-1),e("option",{value:"Failed"},"Failed",-1)])],512),[[R,f.value]]),e("button",{onClick:z,class:"px-6 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg flex items-center gap-2"},[y(m(oe),{class:"w-4 h-4"}),t[14]||(t[14]=S(" Refresh ",-1))])])]),e("div",Se,[t[20]||(t[20]=e("div",{class:"p-6 border-b"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Payment History")],-1)),b.value?(r(),n("div",Te,[...t[15]||(t[15]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Loading payments...",-1)])])):A.value.length===0?(r(),n("div",Ee,[y(m(te),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t[16]||(t[16]=e("p",{class:"text-gray-600"},"No payments found",-1))])):(r(),n("div",Ae,[e("table",De,[t[19]||(t[19]=e("thead",{class:"bg-gray-50 border-b"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Payment ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Todo Item"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Amount"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Date"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1)),e("tbody",Ne,[(r(!0),n(j,null,L(A.value,o=>(r(),n("tr",{key:o.name,class:"hover:bg-gray-50 transition-colors"},[e("td",Re,[e("span",je,l(o.name),1)]),e("td",Le,[e("div",Ve,l(o.todo_item),1)]),e("td",Be,[e("span",He,"\u20B9"+l(o.amount),1)]),e("td",$e,[e("span",{class:H(["px-3 py-1 rounded-full text-xs font-semibold",{"bg-green-100 text-green-800":o.payment_status==="Success","bg-yellow-100 text-yellow-800":o.payment_status==="Pending","bg-red-100 text-red-800":o.payment_status==="Failed"}])},l(o.payment_status),3)]),e("td",qe,l(T(o.payment_date||o.creation)),1),e("td",Ue,[e("div",Oe,[o.payment_status==="Pending"?(r(),n("button",{key:0,onClick:g=>G(o),class:"text-blue-600 hover:text-blue-800 font-medium text-sm flex items-center gap-1"},[y(m(B),{class:"w-4 h-4"}),t[17]||(t[17]=S(" Pay Now ",-1))],8,Xe)):v("",!0),e("button",{onClick:g=>J(o),class:"text-gray-600 hover:text-gray-800 font-medium text-sm flex items-center gap-1"},[y(m(ee),{class:"w-4 h-4"}),t[18]||(t[18]=S(" View ",-1))],8,Ge)])])]))),128))])])]))]),i.value?(r(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t[5]||(t[5]=K(o=>i.value=!1,["self"]))},[e("div",Je,[e("div",Qe,[t[21]||(t[21]=e("h3",{class:"text-xl font-semibold"},"Payment Details",-1)),e("button",{onClick:t[4]||(t[4]=o=>i.value=!1),class:"text-gray-400 hover:text-gray-600"},[y(m(ae),{class:"w-6 h-6"})])]),a.value?(r(),n("div",Ke,[e("div",We,[e("div",null,[t[22]||(t[22]=e("p",{class:"text-sm text-gray-600"},"Payment ID",-1)),e("p",Ye,l(a.value.name),1)]),e("div",null,[t[23]||(t[23]=e("p",{class:"text-sm text-gray-600"},"Status",-1)),e("span",{class:H(["inline-block px-3 py-1 rounded-full text-xs font-semibold",{"bg-green-100 text-green-800":a.value.payment_status==="Success","bg-yellow-100 text-yellow-800":a.value.payment_status==="Pending","bg-red-100 text-red-800":a.value.payment_status==="Failed"}])},l(a.value.payment_status),3)]),e("div",null,[t[24]||(t[24]=e("p",{class:"text-sm text-gray-600"},"Todo Item",-1)),e("p",Ze,l(a.value.todo_item),1)]),e("div",null,[t[25]||(t[25]=e("p",{class:"text-sm text-gray-600"},"Amount",-1)),e("p",et,"\u20B9"+l(a.value.amount),1)]),a.value.razorpay_order_id?(r(),n("div",tt,[t[26]||(t[26]=e("p",{class:"text-sm text-gray-600"},"Razorpay Order ID",-1)),e("p",st,l(a.value.razorpay_order_id),1)])):v("",!0),a.value.razorpay_payment_id?(r(),n("div",ot,[t[27]||(t[27]=e("p",{class:"text-sm text-gray-600"},"Razorpay Payment ID",-1)),e("p",at,l(a.value.razorpay_payment_id),1)])):v("",!0),a.value.payment_method?(r(),n("div",lt,[t[28]||(t[28]=e("p",{class:"text-sm text-gray-600"},"Payment Method",-1)),e("p",nt,l(a.value.payment_method),1)])):v("",!0),e("div",null,[t[29]||(t[29]=e("p",{class:"text-sm text-gray-600"},"Created On",-1)),e("p",rt,l(T(a.value.creation)),1)]),a.value.payment_date?(r(),n("div",dt,[t[30]||(t[30]=e("p",{class:"text-sm text-gray-600"},"Payment Date",-1)),e("p",it,l(T(a.value.payment_date)),1)])):v("",!0),a.value.error_message?(r(),n("div",ut,[t[31]||(t[31]=e("p",{class:"text-sm text-gray-600"},"Error Message",-1)),e("p",ct,l(a.value.error_message),1)])):v("",!0)])])):v("",!0)])])):v("",!0)]))}};export{xt as default};
